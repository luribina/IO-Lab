# Лабораторная работа 2

**Название:** Разработка драйверов блочных устройств"

**Цель работы:** Получить знания и навыки разработки драйверов блочных
устройств для операционной системы Linux. 

## Описание функциональности драйвера

Драйвер создает виртуальный жесткий диск в оперативной памяти с размером 50 Мбайт. Два первичных и один расширенный разделы с размерами 10Мбайт, 20Мбайт и 20Мбайт соответственно. Расширенный раздел  разделен на два логических с размерами по 10Мбайт каждый.

## Инструкция по сборке

1. Собрать драйвер `make`
2. Загрузить драйвер в ядро `insmod lab2.ko`
3. Удалить драйвер `rmmod lab2`
4. Очистить файлы, созданные при сборке `make clean`

## Инструкция пользователя

1. Собрать драйвер в соотвествии инструкции по сборке
2. С помощью `fdisk -l` посмотреть, что созданные разделы соответствуют варианту
3. Отформатировать созданные разделы
    ```
        # mkfs.vfat /dev/lab2p1
        # mkfs.vfat /dev/lab2p2
        # mkfs.vfat /dev/lab2p5
        # mkfs.vfat /dev/lab2p6
    ```
4. Создать точки монтирования и примонтировать к ним какие-либо разделы
    ```
        # mkdir -p /mnt/p1
        # mount /dev/lab2p1 /mnt/p1

        # mkdir -p /mnt/p2
        # mount /dev/lab2p2 /mnt/p2
    ```
5. Создать файл, наполненный случайными данными
    ```
        $ dd if=/dev/urandom of=random.txt bs=5MB count=1
    ```
6. Скопировать файлы с реального диска на виртуальный
    ```
        # cp random.txt /mnt/p1
        # cp /mnt/p1/random.txt .
    ```
7. Скопировать файлы с одного раздела на другой
    ```
        # cp /mnt/p1/random.txt /mnt/p2/random.txt
        # cp /mnt/p2/random.txt /mnt/p1/random.txt
    ```

8. После окончания работы размонтировать разделов
    ```
        # umount /mnt/p1
        # umount /mnt/p2
    ```
9. Удалить драйвер

## Примеры использования

1. `fdisk -l`
    ```
        Disk /dev/lab2: 50 MiB, 52430336 bytes, 102403 sectors
        Units: sectors of 1 * 512 = 512 bytes
        Sector size (logical/physical): 512 bytes / 512 bytes
        I/O size (minimum/optimal): 512 bytes / 512 bytes
        Disklabel type: dos
        Disk identifier: 0x00000000

        Device      Boot Start    End Sectors Size Id Type
        /dev/lab2p1          1  20480   20480  10M 83 Linux
        /dev/lab2p2      20481  61440   40960  20M 83 Linux
        /dev/lab2p3      61441 102402   40962  20M  5 Extended
        /dev/lab2p5      61442  81921   20480  10M 83 Linux
        /dev/lab2p6      81923 102402   20480  10M 83 Linux
    ```
2. Скопировать файл на виртуальный диск
    ```
        # rsync --progress random.txt /mnt/p1 random.txt
    ```
3. Скопировать файл с одного раздела на другой
    ```
        # rsync --progress /mnt/p1/random.txt /mnt/p2
    ```
4. Результаты тестов

размер (MB) | количество тестов | с реального на виртуальный (MB/s) | с виртуального на виртуальный (MB/s)
-------------- | ----------------- | ----------------------------------- | --------------------------------------
5 | 10 | 122 | 127
7 | 10 | 147 | 133
